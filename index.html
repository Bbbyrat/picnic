<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>åˆ¶ä½œå±äºä½ çš„ä¸‹åˆèŒ¶ï¼</title>
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

  <script src="face-api.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 40px 0 0 0;
      background-color: #ffffff;
      background-image:
        linear-gradient(45deg, #fff2bd 25%, transparent 25%, transparent 75%, #fff0b4 75%, #fff1bb),
        linear-gradient(45deg, #fff1b8 25%, transparent 25%, transparent 75%, #ffefad 75%, #ffec9f);
      background-size: 160px 160px;
      background-position: 0 0, 80px 80px;
    }

    h1 {
      font-size: 30px;
      font-weight: 500;
      letter-spacing: 0.08em;
      margin-bottom: 10px;
      font-family: "ZCOOL KuaiLe", cursive;
      color: #d9568f;
    }

    p {
      font-size: 14px;
      color: #d2496b;
      letter-spacing: 0.05em;
      margin-top: 0;
      margin-bottom: 20px;
      font-family: "ZCOOL KuaiLe", cursive;
    }

    #camera-container {
      position: relative;
      width: 320px;
      height: 240px;
      margin: 20px auto 20px auto;
    }

    #video {
      width: 320px;
      height: 240px;
      border-radius: 12px;
      border: 4px solid #ff8aaf;
      box-shadow: 0 10px 20px rgba(255, 195, 29, 0.2);
      transform: scaleX(-1);
    }

    #overlay {
      position: absolute;
      top: 0;
      left: 0;
    }

    button {
      margin-top: 20px;
      padding: 10px 133px;
      font-size: 20px;
      background: #ffc9d4;
      border: none;
      font-family: "ZCOOL KuaiLe", cursive;
      color: #d2496b;
    }

    #result {
      margin-top: 25px;
      white-space: pre-wrap;
      text-align: left;
      width: 320px;
      margin-left: auto;
      margin-right: auto;
      background: #ffc9d4;
      padding: 10px;
      font-family: "ZCOOL KuaiLe", cursive;
      color: #d9568f;
    }

    /* è£…é¥°è¡Œå®¹å™¨ */
    .decor-row {
      display: flex;
      justify-content: center;
      gap: 25px; /* å›¾æ ‡é—´è· */
      margin: 10px 0; /* ä¸Šä¸‹é—´è· */
      pointer-events: none; /* ä¸æŒ¡ç‚¹å‡» */
    }

    /* å•ä¸ªå›¾æ ‡ */
    .decor {
      font-size: 50px;
      opacity: 0.85;
      animation: swing 3s ease-in-out infinite;
      transition: transform 0.3s ease;
    }

    /* æ‘‡æ‘†åŠ¨ç”» */
    @keyframes swing {
      0% { transform: translateX(0); }
      25% { transform: translateX(8px); }
      50% { transform: translateX(0); }
      75% { transform: translateX(-8px); }
      100% { transform: translateX(0); }
    }
  </style>
</head>

<body>
  <h1>ä½ æ‹¥æœ‰äº†ä¸€å—é‡é¤åœ°æ¯¯</h1>
  <p>æŒ‰ç…§æˆ‘ä»¬ä¸ºä½ å®šåˆ¶çš„é£Ÿè°±å¼€å§‹äº«ç”¨å§</p>

  <!-- ä¸Šæ’å›¾æ ‡ -->
  <div class="decor-row" id="decor-top">
    <span class="decor">ğŸª</span>
    <span class="decor">ğŸ</span>
    <span class="decor">ğŸ¥›</span>
    <span class="decor">ğŸ®</span>
    <span class="decor">ğŸ«</span>
  </div>

  <!-- æ‘„åƒå¤´åŒºåŸŸ -->
  <div id="camera-container">
    <video id="video" autoplay muted></video>
    <canvas id="overlay" width="320" height="240"></canvas>
  </div>

  <!-- ä¸‹æ’å›¾æ ‡ -->
  <div class="decor-row" id="decor-bottom">
    <span class="decor">ğŸ§¸</span>
    <span class="decor">ğŸ‰</span>
    <span class="decor">ğŸ</span>
    <span class="decor">â˜•</span>
    <span class="decor">ğŸŒ¸</span>
  </div>

  <button onclick="analyze()">å¼€å§‹åˆ†æ</button>
  <pre id="result">ç­‰å¾…åˆ†æ...</pre>

  <script>
    const video = document.getElementById('video');
    const result = document.getElementById('result');

    // æ‰“å¼€æ‘„åƒå¤´
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(() => {
        alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™");
      });

    // åŠ è½½æ¨¡å‹
    async function loadModels() {
      result.innerText = "æ­£åœ¨åŠ è½½æƒ…ç»ªè¯†åˆ«æ¨¡å‹...";
      await faceapi.nets.tinyFaceDetector.loadFromUri('./models');
      await faceapi.nets.faceExpressionNet.loadFromUri('./models');
      result.innerText = "æ¨¡å‹åŠ è½½å®Œæˆï¼Œè¯·ç‚¹å‡»å¼€å§‹åˆ†æ";
    }

    loadModels();

    // åˆ†ææƒ…ç»ª
    async function analyze() {
      result.innerText = "æ­£åœ¨åˆ†ææƒ…ç»ªå‚æ•°...";
      const detection = await faceapi
        .detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
        .withFaceExpressions();

      if (!detection) {
        result.innerText = "æœªæ£€æµ‹åˆ°äººè„¸ï¼Œè¯·æ­£å¯¹æ‘„åƒå¤´";
        return;
      }

      const mood = mapExpressionsToTenLevels(detection.expressions);
      showRecipe(mood);
    }

    function mapExpressionsToTenLevels(expr) {
      const score = expr.happy - expr.sad;
      if (score <= -0.8) return "æåº¦ä½è½";
      if (score <= -0.6) return "å¾ˆä½è½";
      if (score <= -0.4) return "ä½è½";
      if (score <= -0.2) return "ç•¥ä½è½";
      if (score <= 0) return "ä¸­æ€§åä½";
      if (score <= 0.2) return "ä¸­æ€§åé«˜";
      if (score <= 0.4) return "ç•¥å¼€å¿ƒ";
      if (score <= 0.6) return "å¼€å¿ƒ";
      if (score <= 0.8) return "å¾ˆå¼€å¿ƒ";
      return "éå¸¸å¼€å¿ƒ";
    }

    function showRecipe(mood) {
      const recipes = {
        "æåº¦ä½è½": "ç™½åå¸ + æ›²å¥‡ + å°‘é‡ç‚¼ä¹³ + æœå†» + ç”Ÿæ—¥å¸½ + å°ç†Š",
        "å¾ˆä½è½": "ç™½åå¸ + ç‚¼ä¹³ + æœå†» + å°ç†Š + å·§å…‹åŠ›",
        "ä½è½": "ç™½åå¸ + è‹æ‰“é¥¼å¹² + æœå†» + å°ç†Š",
        "ç•¥ä½è½": "ç™½åå¸ + æ²™æ‹‰é…± + æœå†» + å°‘é‡å·§å…‹åŠ›",
        "ä¸­æ€§åä½": "ç™½åå¸ + æœå†» + å°‘é‡ç‚¼ä¹³ + å°ç†Š",
        "ä¸­æ€§åé«˜": "ç™½åå¸ + æ›²å¥‡ + ç‚¼ä¹³ + å°ç†Š",
        "ç•¥å¼€å¿ƒ": "æ›²å¥‡ + ç™½åå¸ + ç‚¼ä¹³ + è½¯ç³–",
        "å¼€å¿ƒ": "æ›²å¥‡ + ç™½åå¸ + ç‚¼ä¹³ + è½¯ç³– + å°ç†Š",
        "å¾ˆå¼€å¿ƒ": "æ›²å¥‡ + å·§å…‹åŠ› + ç‚¼ä¹³ + è½¯ç³– + å°ç†Š",
        "éå¸¸å¼€å¿ƒ": "æ›²å¥‡ + å·§å…‹åŠ› + ç‚¼ä¹³ + è½¯ç³– + å°ç†Š + ç”Ÿæ—¥å¸½"
      };

      result.innerText =
        `æ£€æµ‹åˆ°æƒ…ç»ªçŠ¶æ€ï¼š${mood}\n\næ¨èè¿›é£Ÿæ–¹æ¡ˆï¼š\n${recipes[mood]}`;
    }
  </script>
</body>
</html>
