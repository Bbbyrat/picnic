<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>åˆ¶ä½œå±äºä½ çš„ä¸‹åˆèŒ¶ï¼</title>
  <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">

  <script src="face-api.min.js"></script>

  <style>
   body {
  font-family: sans-serif;
  text-align: center;
  margin: 40px 0 0 0;

  /* é»„ç™½æ£‹ç›˜æ ¼èƒŒæ™¯ */
  background-color: #ffffff;
  background-image:
    linear-gradient(45deg,
      #fff2bd 25%,
      transparent 25%,
      transparent 75%,
      #fff0b4 75%,
      #fff1bb
    ),
    linear-gradient(45deg,
      #fff1b8 25%,
      transparent 25%,
      transparent 75%,
      #ffefad 75%,
      #ffec9f
    );
  background-size: 160px 160px;
  background-position: 0 0, 80px 80px;
}
<!-- trigger github pages -->



    /* æ‘„åƒå¤´æ•´ä½“å®¹å™¨ */
    #camera-container {
      position: relative;
      width: 320px;
      height: 240px;
      margin:  80px auto 20px auto;
    }

    #video {
      width: 320px;
      height: 240px;
      border-radius: 12px;       /* åœ†è§’ */
      border: 4px solid #ff8aaf; /* æŸ”å’Œçš„é»„æ©™è‰²è¾¹æ¡†ï¼Œå‘¼åº”æ£‹ç›˜æ ¼ */
      box-shadow: 0 10px 20px rgba(255, 195, 29, 0.2); /* è½»å¾®é˜´å½±ï¼Œè®©å®ƒæ‚¬æµ®æ„Ÿ */
      transform: scaleX(-1);
    }

    /* ç”»æ¡†ç”¨çš„ç”»å¸ƒï¼Œç›–åœ¨ video ä¸Š */
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
    }

    button {
      margin-top: 60px;
      padding: 10px 133px;
      font-size: 20px;
      background: #ffc9d4;
      border: none; 
    }

    #result {
      margin-top: 25px;
      white-space: pre-wrap;
      text-align: left;
      width: 320px;
      margin-left: auto;
      margin-right: auto;
      background: #ffc9d4;
      padding: 10px;
    }
    h1 {
     font-size: 30px;
     font-weight: 500;
     letter-spacing: 0.08em;
     margin-bottom: 10px;
    }
    p {
     font-size: 14px;
     color: #d85990;
     letter-spacing: 0.05em;
     margin-top: 0;
     margin-bottom: 20px;
    }
    /* å¯çˆ±å­—ä½“ï¼šç”¨äºæ ‡é¢˜å’Œç»“æœ */
h1,
#result {
  font-family: "ZCOOL KuaiLe", cursive;
  color: #d9568f; 
}


p,
button {
  font-family: "ZCOOL KuaiLe", cursive;
color: #d2496b; 
}

/* å°è£…é¥°å®¹å™¨ï¼šç»‘å®šåœ¨æ‘„åƒå¤´ä¸Š */
#decorations {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 3;

  transform: translateX(6%); 
}




/* æ‚¬åœå°äº’åŠ¨ï¼ˆå¯çˆ±ä½†ä¸æ‰“æ‰°ï¼‰ */
.decor {
  position: absolute;
  font-size: 50px;
  animation: swing 3s ease-in-out infinite;
}

/* ä¸Šæ’ */
.decor:nth-child(1) { top: -28%; left: 0%; }
.decor:nth-child(2) { top: -28%; left: 18%; }
.decor:nth-child(3) { top: -28%; left: 36%; }
.decor:nth-child(4) { top: -32%; left: 54%; }
.decor:nth-child(5) { top: -28%; left: 72%; }

/* ä¸‹æ’ */
.decor:nth-child(6) { bottom: -34%; left: 0%; }
.decor:nth-child(7) { bottom: -34%; left: 18%; }
.decor:nth-child(8) { bottom: -34%; left: 36%; }
.decor:nth-child(9) { bottom: -34%; left: 54%; }
.decor:nth-child(10){ bottom: -34%; left: 72%; }





#camera-container,
button,
#result,
h1,
p {
  position: relative;
  z-index: 2;
}
 /* æ‘‡æ‘†åŠ¨ç”» */
    @keyframes swing {
      0% { transform: translateX(0); }
      25% { transform: translateX(8px); }
      50% { transform: translateX(0); }
      75% { transform: translateX(-8px); }
      100% { transform: translateX(0); }
    }

    

    /* å»¶è¿Ÿè®©æ¯ä¸ªå°ç‰©ä»¶é”™å¼€ */
    .decor:nth-child(1) { animation-delay: 0s; }
    .decor:nth-child(2) { animation-delay: 0.2s; }
    .decor:nth-child(3) { animation-delay: 0.4s; }
    .decor:nth-child(4) { animation-delay: 0.6s; }
    .decor:nth-child(5) { animation-delay: 0.8s; }
    .decor:nth-child(6) { animation-delay: 1.0s; }
    .decor:nth-child(7) { animation-delay: 1.2s; }
    .decor:nth-child(8) { animation-delay: 1.4s; }
    .decor:nth-child(9) { animation-delay: 1.6s; }
    .decor:nth-child(10) { animation-delay: 1.8s; }
    
    


  </style>
</head>

<body>
  <h1>ä½ æ‹¥æœ‰äº†ä¸€å—é‡é¤åœ°æ¯¯</h1>
  <p>æŒ‰ç…§æˆ‘ä»¬ä¸ºä½ å®šåˆ¶çš„é£Ÿè°±å¼€å§‹äº«ç”¨å§</p>
  <!-- é‡é¤å°è£…é¥° -->
<div id="camera-container">
  <video id="video" autoplay muted></video>
  <canvas id="overlay" width="320" height="240"></canvas>

  <!-- ğŸ‘‡ å°è£…é¥°ç°åœ¨å±äºæ‘„åƒå¤´ -->
  <div id="decorations">
    <span class="decor">ğŸª</span>
    <span class="decor">ğŸ</span>
    <span class="decor">ğŸ¥›</span>
    <span class="decor">ğŸ®</span>
    <span class="decor">ğŸ«</span>
    <span class="decor">ğŸ§¸</span>
    <span class="decor">ğŸ‰</span>
    <span class="decor">ğŸ</span>
    <span class="decor">â˜•</span>
    <span class="decor">ğŸŒ¸</span>
  </div>
</div>




 

  <button onclick="analyze()">å¼€å§‹åˆ†æ</button>

  <pre id="result">ç­‰å¾…åˆ†æ...</pre>

  <script>
    const video = document.getElementById('video');
    const result = document.getElementById('result');

    // æ‰“å¼€æ‘„åƒå¤´
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(() => {
        alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™");
      });

    // åŠ è½½æ¨¡å‹
    async function loadModels() {
      result.innerText = "æ­£åœ¨åŠ è½½æƒ…ç»ªè¯†åˆ«æ¨¡å‹...";
      await faceapi.nets.tinyFaceDetector.loadFromUri('./models');
      await faceapi.nets.faceExpressionNet.loadFromUri('./models');
      result.innerText = "æ¨¡å‹åŠ è½½å®Œæˆï¼Œè¯·ç‚¹å‡»å¼€å§‹åˆ†æ";
    }

    loadModels();

    // åˆ†ææƒ…ç»ª
    async function analyze() {
      result.innerText = "æ­£åœ¨åˆ†ææƒ…ç»ªå‚æ•°...";

      const detection = await faceapi
        .detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
        .withFaceExpressions();

      if (!detection) {
        result.innerText = "æœªæ£€æµ‹åˆ°äººè„¸ï¼Œè¯·æ­£å¯¹æ‘„åƒå¤´";
        return;
      }

      const mood = mapExpressionsToTenLevels(detection.expressions);
      showRecipe(mood);
    }

    function mapExpressionsToTenLevels(expr) {
  const score = expr.happy - expr.sad; // ç»¼åˆè¯„åˆ†ï¼ŒèŒƒå›´å¤§çº¦ -1 åˆ° +1
  if (score <= -0.8) return "æåº¦ä½è½";
  if (score <= -0.6) return "å¾ˆä½è½";
  if (score <= -0.4) return "ä½è½";
  if (score <= -0.2) return "ç•¥ä½è½";
  if (score <= 0) return "ä¸­æ€§åä½";
  if (score <= 0.2) return "ä¸­æ€§åé«˜";
  if (score <= 0.4) return "ç•¥å¼€å¿ƒ";
  if (score <= 0.6) return "å¼€å¿ƒ";
  if (score <= 0.8) return "å¾ˆå¼€å¿ƒ";
  return "éå¸¸å¼€å¿ƒ";
}

   function showRecipe(mood) {
  const recipes = {
    "æåº¦ä½è½": "ç™½åå¸ + æ›²å¥‡ + å°‘é‡ç‚¼ä¹³ + æœå†» + ç”Ÿæ—¥å¸½ + å°ç†Š",
    "å¾ˆä½è½": "ç™½åå¸ + ç‚¼ä¹³ + æœå†» + å°ç†Š + å·§å…‹åŠ›",
    "ä½è½": "ç™½åå¸ + è‹æ‰“é¥¼å¹² + æœå†» + å°ç†Š",
    "ç•¥ä½è½": "ç™½åå¸ + æ²™æ‹‰é…± + æœå†» + å°‘é‡å·§å…‹åŠ›",
    "ä¸­æ€§åä½": "ç™½åå¸ + æœå†» + å°‘é‡ç‚¼ä¹³ + å°ç†Š",
    "ä¸­æ€§åé«˜": "ç™½åå¸ + æ›²å¥‡ + ç‚¼ä¹³ + å°ç†Š",
    "ç•¥å¼€å¿ƒ": "æ›²å¥‡ + ç™½åå¸ + ç‚¼ä¹³ + è½¯ç³–",
    "å¼€å¿ƒ": "æ›²å¥‡ + ç™½åå¸ + ç‚¼ä¹³ + è½¯ç³– + å°ç†Š",
    "å¾ˆå¼€å¿ƒ": "æ›²å¥‡ + å·§å…‹åŠ› + ç‚¼ä¹³ + è½¯ç³– + å°ç†Š",
    "éå¸¸å¼€å¿ƒ": "æ›²å¥‡ + å·§å…‹åŠ› + ç‚¼ä¹³ + è½¯ç³– + å°ç†Š + ç”Ÿæ—¥å¸½"
  };

      result.innerText =
        `æ£€æµ‹åˆ°æƒ…ç»ªçŠ¶æ€ï¼š${mood}\n\næ¨èè¿›é£Ÿæ–¹æ¡ˆï¼š\n${recipes[mood]}`;
    }
  </script>
</body>
</html>

